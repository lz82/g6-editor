{"version":3,"sources":["../webpack/universalModuleDefinition","pages/home/index.module.less","components/drop-container/index.module.less","components/drag-item/index.tsx","components/drop-container/index.tsx","pages/home/index.tsx","index.tsx"],"names":["root","factory","exports","module","define","amd","this","style","cursor","DragItem","name","children","onDragEnd","useDrag","item","type","collect","monitor","isDragging","end","dropResult","getDropResult","position","dragRef","opacity","ref","DropContainer","useDrop","accept","drop","getSourceClientOffset","isOver","canDrop","dropRef","className","css","id","Home","editorRef","useRef","minimapRef","editor","useState","node","label","currentEditor","setCurrentEditor","nodes","edges","graphData","G6","registerBehavior","getEvents","click","mousedown","mousemove","mouseup","onMouseClick","ev","preventDefault","onMouseDown","target","get","startsWith","graph","model","getModel","addingEdge","edge","addItem","source","onMouseMove","point","x","y","updateItem","onMouseUp","destroyed","getType","console","log","removeItem","onNodeClick","findAllByState","forEach","cn","setItemState","onEdgeClick","useEffect","minimap","Minimap","container","current","size","grid","Grid","contextMenu","ToolBar","Menu","getContent","handleMenuClick","getID","getEdges","getTarget","getSource","push","offsetX","offsetY","itemTypes","Graph","enabledStack","maxStep","width","scrollWidth","height","scrollHeight","layout","rankdir","ranksep","类型","plugins","modes","default","defaultNode","fill","linkPoints","top","right","bottom","left","nodeStateStyles","defaultEdge","stroke","lineAppendWidth","edgeStateStyles","lineWidth","data","render","key","newNode","anchorPoints","onClick","save","newData","read","classnames","value","onChange","e","ReactDOM","StrictMode","DndProvider","backend","HTML5Backend","document","getElementById","bootstrap","props","a","mount","token","history","setTimeout","unmount","unmountComponentAtNode","window","__POWERED_BY_QIANKUN__"],"mappings":"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","file":"static/js/main.ffd9246b.chunk.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"g6editor\"] = factory();\n\telse\n\t\troot[\"g6editor\"] = factory();\n})(this, function() {\nreturn ","// extracted by mini-css-extract-plugin\nmodule.exports = {\"home\":\"home--1rW0p\",\"content-wrapper\":\"content-wrapper--1s7me\",\"tool-box\":\"tool-box--1zfay\",\"node\":\"node--2dKjL\",\"node-start\":\"node-start--34dXH\",\"node-common\":\"node-common--2xb54\",\"node-juge\":\"node-juge--33Xk-\",\"editor-wrapper\":\"editor-wrapper--oOLko\",\"canvas-wrapper\":\"canvas-wrapper--1_gBK\",\"info-wrapper\":\"info-wrapper--KyDG_\",\"minimap-container\":\"minimap-container--3GEQi\",\"info-editor\":\"info-editor--3MHIM\",\"row\":\"row--3Tcjj\",\"btn-wrapper\":\"btn-wrapper--3biwx\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"drop-container\":\"drop-container--2Ajpm\"};","import React, { FC } from 'react';\nimport { useDrag, DragSourceMonitor } from 'react-dnd';\n\ninterface DragItemProps {\n  name: string;\n  onDragEnd: Function;\n}\n\nconst style: React.CSSProperties = {\n  cursor: 'move'\n};\n\nconst DragItem: FC<DragItemProps> = ({ name, children, onDragEnd }) => {\n  const [{ isDragging }, dragRef] = useDrag({\n    item: { name, type: 'DragItem' },\n    collect: (monitor) => ({\n      isDragging: monitor.isDragging()\n    }),\n    end: (item, monitor: DragSourceMonitor) => {\n      const dropResult = monitor.getDropResult();\n      if (item && dropResult) {\n        onDragEnd && onDragEnd(item, dropResult.position);\n      }\n    }\n  });\n  const opacity = isDragging ? 0.4 : 1;\n  return (\n    <li ref={dragRef} style={{ ...style, opacity }}>\n      {children}\n    </li>\n  );\n};\n\nexport default DragItem;\n","import React, { FC } from 'react';\nimport { useDrop, DropTargetMonitor } from 'react-dnd';\nimport css from './index.module.less';\nconst DropContainer: FC = ({ children }) => {\n  const [{ canDrop, isOver }, dropRef] = useDrop({\n    accept: 'DragItem',\n    drop: (item, monitor) => ({ item, position: monitor.getSourceClientOffset() }),\n    collect: (monitor: DropTargetMonitor) => ({\n      isOver: monitor.isOver(),\n      canDrop: monitor.canDrop()\n    })\n  });\n\n  return (\n    <div className={css['drop-container']} ref={dropRef}>\n      {children}\n    </div>\n  );\n};\n\nexport default DropContainer;\n","import React, { useRef, useEffect, useState } from 'react';\n\nimport classnames from 'classnames';\n\nimport G6, { Minimap, Grid, Graph, ToolBar, Menu } from '@antv/g6';\nimport DragItem from '@/components/drag-item';\nimport { GraphData } from '@antv/g6/lib/types';\nimport { IEdge } from '@antv/g6/lib/interface/item';\n\nimport DropContainer from '@/components/drop-container';\nimport css from './index.module.less';\n\nconst NODE_WIDTH = 80;\nconst NODE_HEIGHT = 80;\n\nlet id = 1;\n\nconst Home = () => {\n  const editorRef = useRef<HTMLDivElement>(null);\n  const minimapRef = useRef<HTMLDivElement>(null);\n  const editor = useRef<Graph>();\n  const [currentEditor, setCurrentEditor] = useState<{ id: string; node: any; label: string }>({\n    id: '',\n    node: null,\n    label: ''\n  });\n\n  const [graphData, setGraphData] = useState<GraphData>({\n    nodes: [],\n    // 边集\n    edges: []\n  });\n\n  G6.registerBehavior('drag-point-add-edge', {\n    getEvents() {\n      return {\n        click: 'onMouseClick',\n        mousedown: 'onMouseDown',\n        mousemove: 'onMouseMove',\n        mouseup: 'onMouseUp',\n        'node:click': 'onNodeClick',\n        'edge:click': 'onEdgeClick'\n      };\n    },\n    onMouseClick(ev: any) {\n      ev.preventDefault();\n      if (!ev.item) {\n        setCurrentEditor({\n          id: '',\n          node: null,\n          label: ''\n        });\n      }\n    },\n    onMouseDown(ev: any) {\n      ev.preventDefault();\n      const self = this;\n      const node = ev.item;\n      if (node && ev.target.get('className').startsWith('link-point')) {\n        const graph = self.graph as Graph;\n        const model = node.getModel();\n\n        if (!self.addingEdge && !self.edge) {\n          self.edge = graph.addItem('edge', {\n            source: model.id,\n            target: model.id\n          });\n          self.addingEdge = true;\n        }\n      }\n    },\n    onMouseMove(ev: any) {\n      ev.preventDefault();\n      const self = this;\n      const point = { x: ev.x, y: ev.y };\n      if (self.addingEdge && self.edge) {\n        (self.graph as Graph).updateItem(self.edge as IEdge, {\n          target: point\n        });\n      }\n    },\n    onMouseUp(ev: any) {\n      ev.preventDefault();\n      const self = this;\n      const node = ev.item;\n      const graph = self.graph as Graph;\n      // 这里会走两次，第二次destroyed为true\n      // 因此增加判断\n      if (node && !node.destroyed && node.getType() === 'node') {\n        const model = node.getModel();\n        console.log(model);\n        if (self.addingEdge && self.edge) {\n          graph.updateItem(self.edge as IEdge, {\n            target: model.id\n          });\n          self.edge = null;\n          self.addingEdge = false;\n        }\n      } else {\n        if (self.addingEdge && self.edge) {\n          graph.removeItem(self.edge as IEdge);\n          self.edge = null;\n          self.addingEdge = false;\n        }\n      }\n    },\n    onNodeClick(ev: any) {\n      ev.preventDefault();\n      const self = this;\n      const graph = self.graph as Graph;\n      const item = ev.item;\n      if (item) {\n        // 将当前是click的都设为false\n        const clickNodes = graph.findAllByState('node', 'click');\n        clickNodes.forEach((cn) => {\n          graph.setItemState(cn, 'click', false);\n        });\n        // 将当前是click的都设为false\n        const clickEdgees = graph.findAllByState('edge', 'click');\n        clickEdgees.forEach((cn) => {\n          graph.setItemState(cn, 'click', false);\n        });\n        // 将当前node设为click\n        console.log('to click item', item);\n        graph.setItemState(item, 'click', true);\n        const model = item.getModel();\n\n        setCurrentEditor({ id: model.id, node: item, label: model.label });\n      }\n    },\n    onEdgeClick(ev: any) {\n      ev.preventDefault();\n      const self = this;\n      const graph = self.graph as Graph;\n      const item = ev.item;\n      // 将当前是click的都设为false\n      const clickNodes = graph.findAllByState('node', 'click');\n      clickNodes.forEach((cn) => {\n        graph.setItemState(cn, 'click', false);\n      });\n      const clickEdgees = graph.findAllByState('edge', 'click');\n      clickEdgees.forEach((cn) => {\n        graph.setItemState(cn, 'click', false);\n      });\n      // 将当前node设为click\n      graph.setItemState(item, 'click', true);\n      const model = item.getModel();\n      console.log(model);\n\n      setCurrentEditor({ id: model.id, node: item, label: model.label || '' });\n    }\n  });\n\n  useEffect(() => {\n    // const canvasDom = document.querySelector('#editor-wrapper') as HTMLElement;\n\n    // plugins define\n    const minimap = new Minimap({\n      container: minimapRef.current,\n      size: [200, 160]\n    });\n\n    const grid = new Grid();\n    const toolbar = new ToolBar();\n    const contextMenu = new Menu({\n      getContent(graph: any) {\n        console.log('graph', graph);\n        return `<span>删除</span>`;\n      },\n      handleMenuClick: (target: any, item: any) => {\n        const id = item.getID();\n        const type = item.getType();\n\n        if (type === 'edge') {\n          editor.current?.removeItem(item as IEdge);\n        } else if (type === 'node') {\n          let edges: IEdge[] = [];\n          editor.current?.getEdges().forEach((item) => {\n            if (item.getTarget().getID() === id || item.getSource().getID() === id) {\n              edges.push(item);\n            }\n          });\n          console.log(edges);\n          edges.forEach((edge) => {\n            editor.current?.removeItem(edge);\n          });\n          editor.current?.removeItem(item as IEdge);\n        }\n      },\n      offsetX: 16,\n      offsetY: 40,\n      // the types of items that allow the menu show up\n      // 在哪些类型的元素上响应\n      itemTypes: ['node', 'edge']\n    });\n\n    editor.current = new G6.Graph({\n      container: editorRef.current as HTMLDivElement,\n      enabledStack: true,\n      maxStep: 20,\n      width: editorRef.current?.scrollWidth || 1000,\n      height: editorRef.current?.scrollHeight || 800,\n      layout: {\n        type: 'dagre',\n        rankdir: 'TB',\n        ranksep: 30,\n        类型: 30\n      },\n      plugins: [grid, minimap, contextMenu],\n      modes: {\n        default: [\n          'drag-node',\n          'drag-point-add-edge'\n          // 'tooltip',\n          // 'edge-tooltip',\n        ]\n      },\n      defaultNode: {\n        style: {\n          fill: '#FFF'\n        },\n        linkPoints: {\n          top: true,\n          right: true,\n          bottom: true,\n          left: true,\n          size: 10,\n          fill: '#fff'\n        }\n      },\n      nodeStateStyles: {\n        click: {\n          fill: '#C6E5FF'\n        }\n      },\n      defaultEdge: {\n        type: 'polyline',\n        style: {\n          stroke: '#F6BD16',\n          lineAppendWidth: 10\n        }\n      },\n      edgeStateStyles: {\n        click: {\n          lineWidth: 5\n        }\n      }\n    });\n\n    editor.current.data(graphData);\n\n    editor.current.render();\n  }, [graphData]);\n\n  const getNodeStyle = (name: string) => {\n    if (name === 'common') {\n      return {\n        type: 'circle',\n        size: 80,\n        style: {\n          stroke: 'blue',\n          fill: '#FFF'\n        }\n      };\n    } else if (name === 'start') {\n      return {\n        type: 'rect',\n        size: [80, 40],\n        style: {\n          fill: '#FFF',\n          stroke: 'red'\n        }\n      };\n    } else if (name === 'juge') {\n      return {\n        type: 'diamond',\n        size: 80,\n        style: {\n          fill: '#FFF',\n          stroke: 'yellow'\n        }\n      };\n    }\n  };\n\n  const onDragEnd = (item: { name: string }, position: { x: number; y: number }) => {\n    // const point = editor.current?.getPointByClient(position.x, position.y);\n    // console.log(point);\n    if (position && position.x > 160 && position.y > 50) {\n      // 完全进入画布，则生成一个节点\n      let key = `id-${id++}`;\n      const style = getNodeStyle(item.name);\n      const newNode = {\n        ...style,\n        id: key,\n        x: position.x - (160 - NODE_WIDTH / 2),\n        y: position.y - (50 - NODE_HEIGHT / 2),\n        anchorPoints: [\n          [0.5, 0],\n          [1, 0.5],\n          [0.5, 1],\n          [0, 0.5]\n        ],\n        label: item.name\n      };\n      editor.current?.addItem('node', newNode);\n    }\n  };\n\n  const onRefresh = () => {\n    if (editor.current) {\n      // editor.current.refreshPositions();\n      // editor.current.render();\n      console.log(editor.current.save());\n      const newData = editor.current.save() as GraphData;\n      editor.current.read(newData);\n      // editor.current.changeData();\n    }\n  };\n\n  const onEditorSave = (e: any) => {\n    e.preventDefault();\n    editor.current?.updateItem(currentEditor.node, { label: currentEditor.label });\n  };\n\n  const onInputChange = (e: any) => {\n    setCurrentEditor({ ...currentEditor, label: e.target.value });\n  };\n\n  const onShowData = () => {\n    console.log(editor.current?.save());\n  };\n\n  return (\n    <div className={css['home']}>\n      <header>\n        流程编辑器 &nbsp;&nbsp;&nbsp;<button onClick={onRefresh}>对齐</button>&nbsp;&nbsp;\n        <button onClick={onShowData}>show Data</button>\n      </header>\n\n      <div className={css['content-wrapper']}>\n        <div className={css['tool-box']}>\n          <ul>\n            <DragItem name=\"start\" onDragEnd={onDragEnd}>\n              <div className={classnames(css['node-start'], css['node'])}>起点</div>\n            </DragItem>\n            <DragItem name=\"common\" onDragEnd={onDragEnd}>\n              <div className={classnames(css['node-common'], css['node'])}>常规</div>\n            </DragItem>\n            <DragItem name=\"juge\" onDragEnd={onDragEnd}>\n              <div className={classnames(css['node-juge'], css['node'])}>\n                <span>判断</span>\n              </div>\n            </DragItem>\n          </ul>\n        </div>\n\n        <div id=\"editor-wrapper\" className={css['editor-wrapper']}>\n          <DropContainer>\n            <div className={css['canvas-wrapper']} ref={editorRef}></div>\n          </DropContainer>\n        </div>\n\n        <div className={css['info-wrapper']}>\n          <div ref={minimapRef} className=\"minimap-container\"></div>\n          {currentEditor.id ? (\n            <div className={css['info-editor']}>\n              <h4>编辑</h4>\n\n              <div className={css['row']}>\n                <label>节点名称:</label>\n                <input value={currentEditor.label} onChange={onInputChange} />\n              </div>\n\n              <div className={css['btn-wrapper']}>\n                <button onClick={onEditorSave}>保存</button>\n              </div>\n            </div>\n          ) : null}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Home;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { DndProvider } from 'react-dnd';\nimport { HTML5Backend } from 'react-dnd-html5-backend';\nimport Home from './pages/home';\nimport 'normalize.css/normalize.css';\nimport './styles/index.less';\n\nfunction render() {\n  ReactDOM.render(\n    <React.StrictMode>\n      <DndProvider backend={HTML5Backend}>\n        <Home />\n      </DndProvider>\n    </React.StrictMode>,\n    document.getElementById('g6-root')\n  );\n}\n\n// 独立运行时\nif (!window.__POWERED_BY_QIANKUN__) {\n  render();\n}\n/**\n * bootstrap 只会在微应用初始化的时候调用一次，下次微应用重新进入时会直接调用 mount 钩子，不会再重复触发 bootstrap。\n * 通常我们可以在这里做一些全局变量的初始化，比如不会在 unmount 阶段被销毁的应用级别的缓存等。\n */\nexport async function bootstrap(props: any) {\n  console.log('react app bootstraped', props);\n}\n/**\n * 应用每次进入都会调用 mount 方法，通常我们在这里触发应用的渲染方法\n */\nexport async function mount(props: any) {\n  // console.log(props);\n  const { token, history } = props;\n  // 将token注入cookie、全局状态等\n  console.log(token);\n  setTimeout(() => {\n    history.push('/admin/user/list');\n  }, 3000);\n  render();\n}\n/**\n * 应用每次 切出/卸载 会调用的方法，通常在这里我们会卸载微应用的应用实例\n */\nexport async function unmount() {\n  ReactDOM.unmountComponentAtNode(document.getElementById('g6-root')!);\n}\n"],"sourceRoot":""}