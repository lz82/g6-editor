{"version":3,"sources":["pages/home/index.module.less","components/drop-container/index.module.less","components/drag-item/index.tsx","components/drop-container/index.tsx","pages/home/index.tsx","index.tsx"],"names":["module","exports","style","cursor","DragItem","name","children","onDragEnd","useDrag","item","type","collect","monitor","isDragging","end","dropResult","getDropResult","position","dragRef","opacity","ref","DropContainer","useDrop","accept","drop","getSourceClientOffset","isOver","canDrop","dropRef","className","css","id","Home","editorRef","useRef","minimapRef","editor","useState","node","label","currentEditor","setCurrentEditor","nodes","edges","graphData","G6","registerBehavior","getEvents","click","mousedown","mousemove","mouseup","onMouseClick","ev","preventDefault","onMouseDown","target","get","startsWith","graph","this","model","getModel","addingEdge","edge","addItem","source","onMouseMove","point","x","y","updateItem","onMouseUp","destroyed","getType","console","log","removeItem","onNodeClick","findAllByState","forEach","cn","setItemState","onEdgeClick","useEffect","minimap","Minimap","container","current","size","grid","Grid","toolbar","ToolBar","contextMenu","Menu","getContent","handleMenuClick","getID","getEdges","getTarget","getSource","push","offsetX","offsetY","itemTypes","Graph","enabledStack","maxStep","width","scrollWidth","height","scrollHeight","layout","rankdir","ranksep","类型","plugins","modes","default","defaultNode","fill","linkPoints","top","right","bottom","left","nodeStateStyles","defaultEdge","stroke","lineAppendWidth","edgeStateStyles","lineWidth","data","render","key","newNode","anchorPoints","onClick","save","newData","read","classnames","value","onChange","e","ReactDOM","StrictMode","DndProvider","backend","HTML5Backend","document","getElementById"],"mappings":"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","file":"static/js/main.e6882097.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"home\":\"home--1rW0p\",\"content-wrapper\":\"content-wrapper--1s7me\",\"tool-box\":\"tool-box--1zfay\",\"node\":\"node--2dKjL\",\"node-start\":\"node-start--34dXH\",\"node-common\":\"node-common--2xb54\",\"node-juge\":\"node-juge--33Xk-\",\"editor-wrapper\":\"editor-wrapper--oOLko\",\"canvas-wrapper\":\"canvas-wrapper--1_gBK\",\"info-wrapper\":\"info-wrapper--KyDG_\",\"minimap-container\":\"minimap-container--3GEQi\",\"info-editor\":\"info-editor--3MHIM\",\"row\":\"row--3Tcjj\",\"btn-wrapper\":\"btn-wrapper--3biwx\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"drop-container\":\"drop-container--2Ajpm\"};","import React, { FC } from 'react';\nimport { useDrag, DragSourceMonitor } from 'react-dnd';\n\ninterface DragItemProps {\n  name: string;\n  onDragEnd: Function;\n}\n\nconst style: React.CSSProperties = {\n  cursor: 'move'\n};\n\nconst DragItem: FC<DragItemProps> = ({ name, children, onDragEnd }) => {\n  const [{ isDragging }, dragRef] = useDrag({\n    item: { name, type: 'DragItem' },\n    collect: (monitor) => ({\n      isDragging: monitor.isDragging()\n    }),\n    end: (item, monitor: DragSourceMonitor) => {\n      const dropResult = monitor.getDropResult();\n      if (item && dropResult) {\n        onDragEnd && onDragEnd(item, dropResult.position);\n      }\n    }\n  });\n  const opacity = isDragging ? 0.4 : 1;\n  return (\n    <li ref={dragRef} style={{ ...style, opacity }}>\n      {children}\n    </li>\n  );\n};\n\nexport default DragItem;\n","import React, { FC } from 'react';\nimport { useDrop, DropTargetMonitor } from 'react-dnd';\nimport css from './index.module.less';\nconst DropContainer: FC = ({ children }) => {\n  const [{ canDrop, isOver }, dropRef] = useDrop({\n    accept: 'DragItem',\n    drop: (item, monitor) => ({ item, position: monitor.getSourceClientOffset() }),\n    collect: (monitor: DropTargetMonitor) => ({\n      isOver: monitor.isOver(),\n      canDrop: monitor.canDrop()\n    })\n  });\n\n  return (\n    <div className={css['drop-container']} ref={dropRef}>\n      {children}\n    </div>\n  );\n};\n\nexport default DropContainer;\n","import React, { useRef, useEffect, useState } from 'react';\n\nimport classnames from 'classnames';\n\nimport G6, { Minimap, Grid, Graph, ToolBar, Menu } from '@antv/g6';\nimport DragItem from '@/components/drag-item';\nimport { GraphData } from '@antv/g6/lib/types';\nimport { IEdge } from '@antv/g6/lib/interface/item';\n\nimport DropContainer from '@/components/drop-container';\nimport css from './index.module.less';\n\nconst NODE_WIDTH = 80;\nconst NODE_HEIGHT = 80;\n\nlet id = 1;\n\nconst Home = () => {\n  const editorRef = useRef<HTMLDivElement>(null);\n  const minimapRef = useRef<HTMLDivElement>(null);\n  const editor = useRef<Graph>();\n  const [currentEditor, setCurrentEditor] = useState<{ id: string; node: any; label: string }>({\n    id: '',\n    node: null,\n    label: ''\n  });\n\n  const [graphData, setGraphData] = useState<GraphData>({\n    nodes: [],\n    // 边集\n    edges: []\n  });\n\n  G6.registerBehavior('drag-point-add-edge', {\n    getEvents() {\n      return {\n        click: 'onMouseClick',\n        mousedown: 'onMouseDown',\n        mousemove: 'onMouseMove',\n        mouseup: 'onMouseUp',\n        'node:click': 'onNodeClick',\n        'edge:click': 'onEdgeClick'\n      };\n    },\n    onMouseClick(ev: any) {\n      ev.preventDefault();\n      if (!ev.item) {\n        setCurrentEditor({\n          id: '',\n          node: null,\n          label: ''\n        });\n      }\n    },\n    onMouseDown(ev: any) {\n      ev.preventDefault();\n      const self = this;\n      const node = ev.item;\n      if (node && ev.target.get('className').startsWith('link-point')) {\n        const graph = self.graph as Graph;\n        const model = node.getModel();\n\n        if (!self.addingEdge && !self.edge) {\n          self.edge = graph.addItem('edge', {\n            source: model.id,\n            target: model.id\n          });\n          self.addingEdge = true;\n        }\n      }\n    },\n    onMouseMove(ev: any) {\n      ev.preventDefault();\n      const self = this;\n      const point = { x: ev.x, y: ev.y };\n      if (self.addingEdge && self.edge) {\n        (self.graph as Graph).updateItem(self.edge as IEdge, {\n          target: point\n        });\n      }\n    },\n    onMouseUp(ev: any) {\n      ev.preventDefault();\n      const self = this;\n      const node = ev.item;\n      const graph = self.graph as Graph;\n      // 这里会走两次，第二次destroyed为true\n      // 因此增加判断\n      if (node && !node.destroyed && node.getType() === 'node') {\n        const model = node.getModel();\n        console.log(model);\n        if (self.addingEdge && self.edge) {\n          graph.updateItem(self.edge as IEdge, {\n            target: model.id\n          });\n          self.edge = null;\n          self.addingEdge = false;\n        }\n      } else {\n        if (self.addingEdge && self.edge) {\n          graph.removeItem(self.edge as IEdge);\n          self.edge = null;\n          self.addingEdge = false;\n        }\n      }\n    },\n    onNodeClick(ev: any) {\n      ev.preventDefault();\n      const self = this;\n      const graph = self.graph as Graph;\n      const item = ev.item;\n      if (item) {\n        // 将当前是click的都设为false\n        const clickNodes = graph.findAllByState('node', 'click');\n        clickNodes.forEach((cn) => {\n          graph.setItemState(cn, 'click', false);\n        });\n        // 将当前是click的都设为false\n        const clickEdgees = graph.findAllByState('edge', 'click');\n        clickEdgees.forEach((cn) => {\n          graph.setItemState(cn, 'click', false);\n        });\n        // 将当前node设为click\n        console.log('to click item', item);\n        graph.setItemState(item, 'click', true);\n        const model = item.getModel();\n\n        setCurrentEditor({ id: model.id, node: item, label: model.label });\n      }\n    },\n    onEdgeClick(ev: any) {\n      ev.preventDefault();\n      const self = this;\n      const graph = self.graph as Graph;\n      const item = ev.item;\n      // 将当前是click的都设为false\n      const clickNodes = graph.findAllByState('node', 'click');\n      clickNodes.forEach((cn) => {\n        graph.setItemState(cn, 'click', false);\n      });\n      const clickEdgees = graph.findAllByState('edge', 'click');\n      clickEdgees.forEach((cn) => {\n        graph.setItemState(cn, 'click', false);\n      });\n      // 将当前node设为click\n      graph.setItemState(item, 'click', true);\n      const model = item.getModel();\n      console.log(model);\n\n      setCurrentEditor({ id: model.id, node: item, label: model.label || '' });\n    }\n  });\n\n  useEffect(() => {\n    // const canvasDom = document.querySelector('#editor-wrapper') as HTMLElement;\n\n    // plugins define\n    const minimap = new Minimap({\n      container: minimapRef.current,\n      size: [200, 160]\n    });\n\n    const grid = new Grid();\n    const toolbar = new ToolBar();\n    const contextMenu = new Menu({\n      getContent(graph: any) {\n        console.log('graph', graph);\n        return `<span>删除</span>`;\n      },\n      handleMenuClick: (target: any, item: any) => {\n        const id = item.getID();\n        const type = item.getType();\n\n        if (type === 'edge') {\n          editor.current?.removeItem(item as IEdge);\n        } else if (type === 'node') {\n          let edges: IEdge[] = [];\n          editor.current?.getEdges().forEach((item) => {\n            if (item.getTarget().getID() === id || item.getSource().getID() === id) {\n              edges.push(item);\n            }\n          });\n          console.log(edges);\n          edges.forEach((edge) => {\n            editor.current?.removeItem(edge);\n          });\n          editor.current?.removeItem(item as IEdge);\n        }\n      },\n      offsetX: 16,\n      offsetY: 40,\n      // the types of items that allow the menu show up\n      // 在哪些类型的元素上响应\n      itemTypes: ['node', 'edge']\n    });\n\n    editor.current = new G6.Graph({\n      container: editorRef.current as HTMLDivElement,\n      enabledStack: true,\n      maxStep: 20,\n      width: editorRef.current?.scrollWidth || 1000,\n      height: editorRef.current?.scrollHeight || 800,\n      layout: {\n        type: 'dagre',\n        rankdir: 'TB',\n        ranksep: 30,\n        类型: 30\n      },\n      plugins: [grid, minimap, toolbar, contextMenu],\n      modes: {\n        default: [\n          'drag-node',\n          'drag-point-add-edge'\n          // 'tooltip',\n          // 'edge-tooltip',\n        ]\n      },\n      defaultNode: {\n        style: {\n          fill: '#FFF'\n        },\n        linkPoints: {\n          top: true,\n          right: true,\n          bottom: true,\n          left: true,\n          size: 10,\n          fill: '#fff'\n        }\n      },\n      nodeStateStyles: {\n        click: {\n          fill: '#C6E5FF'\n        }\n      },\n      defaultEdge: {\n        type: 'polyline',\n        style: {\n          stroke: '#F6BD16',\n          lineAppendWidth: 10\n        }\n      },\n      edgeStateStyles: {\n        click: {\n          lineWidth: 5\n        }\n      }\n    });\n\n    editor.current.data(graphData);\n\n    editor.current.render();\n  }, [graphData]);\n\n  const getNodeStyle = (name: string) => {\n    if (name === 'common') {\n      return {\n        type: 'circle',\n        size: 80,\n        style: {\n          stroke: 'blue',\n          fill: '#FFF'\n        }\n      };\n    } else if (name === 'start') {\n      return {\n        type: 'rect',\n        size: [80, 40],\n        style: {\n          fill: '#FFF',\n          stroke: 'red'\n        }\n      };\n    } else if (name === 'juge') {\n      return {\n        type: 'diamond',\n        size: 80,\n        style: {\n          fill: '#FFF',\n          stroke: 'yellow'\n        }\n      };\n    }\n  };\n\n  const onDragEnd = (item: { name: string }, position: { x: number; y: number }) => {\n    // const point = editor.current?.getPointByClient(position.x, position.y);\n    // console.log(point);\n    if (position && position.x > 160 && position.y > 50) {\n      // 完全进入画布，则生成一个节点\n      let key = `id-${id++}`;\n      const style = getNodeStyle(item.name);\n      const newNode = {\n        ...style,\n        id: key,\n        x: position.x - (160 - NODE_WIDTH / 2),\n        y: position.y - (50 - NODE_HEIGHT / 2),\n        anchorPoints: [\n          [0.5, 0],\n          [1, 0.5],\n          [0.5, 1],\n          [0, 0.5]\n        ],\n        label: item.name\n      };\n      editor.current?.addItem('node', newNode);\n    }\n  };\n\n  const onRefresh = () => {\n    if (editor.current) {\n      // editor.current.refreshPositions();\n      // editor.current.render();\n      console.log(editor.current.save());\n      const newData = editor.current.save() as GraphData;\n      editor.current.read(newData);\n      // editor.current.changeData();\n    }\n  };\n\n  const onEditorSave = (e: any) => {\n    e.preventDefault();\n    editor.current?.updateItem(currentEditor.node, { label: currentEditor.label });\n  };\n\n  const onInputChange = (e: any) => {\n    setCurrentEditor({ ...currentEditor, label: e.target.value });\n  };\n\n  const onShowData = () => {\n    console.log(editor.current?.save());\n  };\n\n  return (\n    <div className={css['home']}>\n      <header>\n        流程编辑器 &nbsp;&nbsp;&nbsp;<button onClick={onRefresh}>对齐</button>&nbsp;&nbsp;\n        <button onClick={onShowData}>show Data</button>\n      </header>\n\n      <div className={css['content-wrapper']}>\n        <div className={css['tool-box']}>\n          <ul>\n            <DragItem name=\"start\" onDragEnd={onDragEnd}>\n              <div className={classnames(css['node-start'], css['node'])}>起点</div>\n            </DragItem>\n            <DragItem name=\"common\" onDragEnd={onDragEnd}>\n              <div className={classnames(css['node-common'], css['node'])}>常规</div>\n            </DragItem>\n            <DragItem name=\"juge\" onDragEnd={onDragEnd}>\n              <div className={classnames(css['node-juge'], css['node'])}>\n                <span>判断</span>\n              </div>\n            </DragItem>\n          </ul>\n        </div>\n\n        <div id=\"editor-wrapper\" className={css['editor-wrapper']}>\n          <DropContainer>\n            <div className={css['canvas-wrapper']} ref={editorRef}></div>\n          </DropContainer>\n        </div>\n\n        <div className={css['info-wrapper']}>\n          <div ref={minimapRef} className=\"minimap-container\"></div>\n          {currentEditor.id ? (\n            <div className={css['info-editor']}>\n              <h4>编辑</h4>\n\n              <div className={css['row']}>\n                <label>节点名称:</label>\n                <input value={currentEditor.label} onChange={onInputChange} />\n              </div>\n\n              <div className={css['btn-wrapper']}>\n                <button onClick={onEditorSave}>保存</button>\n              </div>\n            </div>\n          ) : null}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Home;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { DndProvider } from 'react-dnd';\nimport { HTML5Backend } from 'react-dnd-html5-backend';\nimport Home from './pages/home';\nimport 'normalize.css/normalize.css';\nimport './styles/index.less';\n\nReactDOM.render(\n  <React.StrictMode>\n    <DndProvider backend={HTML5Backend}>\n      <Home />\n    </DndProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}